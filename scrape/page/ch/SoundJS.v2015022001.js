/*
* SoundJS
* Visit http://createjs.com/ for documentation, updates and examples.
*
*
* Copyright (c) 2012 gskinner.com, inc.
*
* Permission is hereby granted, free of charge, to any person
* obtaining a copy of this software and associated documentation
* files (the "Software"), to deal in the Software without
* restriction, including without limitation the rights to use,
* copy, modify, merge, publish, distribute, sublicense, and/or sell
* copies of the Software, and to permit persons to whom the
* Software is furnished to do so, subject to the following
* conditions:
*
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
* OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
* HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
* WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
* FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
* OTHER DEALINGS IN THE SOFTWARE.
*/

this.createjs=this.createjs||{};
(function(){function b(){throw"SoundJS cannot be instantiated";}function e(a,b){this.init(a,b)}function f(){}b.DELIMITER="|";b.AUDIO_TIMEOUT=8E3;b.INTERRUPT_ANY="any";b.INTERRUPT_EARLY="early";b.INTERRUPT_LATE="late";b.INTERRUPT_NONE="none";b.PLAY_INITED="playInited";b.PLAY_SUCCEEDED="playSucceeded";b.PLAY_INTERRUPTED="playInterrupted";b.PLAY_FINISHED="playFinished";b.PLAY_FAILED="playFailed";b.activePlugin=null;b.muted=!1;b.pluginsRegistered=!1;b.masterVolume=1;b.instances=[];b.instanceHash={};b.idHash=
null;b.defaultSoundInstance=null;b.getPreloadHandlers=function(){return{callback:b.proxy(b.initLoad,b),types:["sound"],extensions:["mp3","ogg","wav"]}};b.registerPlugins=function(a){b.pluginsRegistered=!0;for(var g=0,c=a.length;g<c;g++){var d=a[g];if(null!=d&&d.isSupported())return b.activePlugin=new d,!0}return!1};b.registerPlugin=function(a){b.pluginsRegistered=!0;return null==a?!1:a.isSupported()?(b.activePlugin=new a,!0):!1};b.isReady=function(){return null!=b.activePlugin};b.getCapabilities=
function(){return null==b.activePlugin?null:b.activePlugin.capabilities};b.getCapability=function(a){return null==b.activePlugin?null:b.activePlugin.capabilities[a]};b.initLoad=function(a,g,c,d){if(!b.checkPlugin(!0))return!1;a=b.parsePath(a,g,c,d);if(null==a)return!1;null!=c&&(null==b.idHash&&(b.idHash={}),b.idHash[c]=a.src);e.create(a.src,d);c=b.activePlugin.register(a.src,d);null!=c&&(null!=c.tag?a.tag=c.tag:c.src&&(a.src=c.src),null!=c.completeHandler&&(a.handler=c.completeHandler));return a};
b.parsePath=function(a,g,c,d){for(var a=a.split(b.DELIMITER),g={type:g||"sound",id:c,data:d,handler:b.handleSoundReady},c=!1,d=b.getCapabilities(),h=0,f=a.length;h<f;h++){var e=a[h],i=e.lastIndexOf("."),j=e.substr(i+1).toLowerCase(),i=e.substr(0,i).split("/").pop();switch(j){case "mp3":d.mp3&&(c=!0);break;case "ogg":d.ogg&&(c=!0);break;case "wav":d.wav&&(c=!0)}if(c)return g.name=i,g.src=e,g.extension=j,g}return null};b.play=function(a,g,c,d,h,e,f){if(!b.checkPlugin(!0))return b.defaultSoundInstance;
a=b.getSrcFromId(a);a=b.activePlugin.create(a);try{a.mute(b.muted)}catch(i){}b.playInstance(a,g,c,d,h,e,f)||a.playFailed();return a};b.playInstance=function(a,g,c,d,h,e,f){g=g||b.INTERRUPT_NONE;null==c&&(c=0);null==d&&(d=0);null==h&&(h=0);null==e&&(e=1);null==f&&(f=0);if(0==c){if(!b.beginPlaying(a,g,d,h,e,f))return!1}else setTimeout(function(){b.beginPlaying(a,g,d,h,e,f)},c);this.instances.push(a);this.instanceHash[a.uniqueId]=a;return!0};b.beginPlaying=function(a,b,c,d,h,f){return!e.add(a,b)?!1:
!a.beginPlaying(c,d,h,f)?(b=this.instances.indexOf(a),-1<b&&this.instances.splice(b,1),delete this.instanceHash[a.uniqueId],!1):!0};b.checkPlugin=function(a){return null==b.activePlugin&&(a&&!b.pluginsRegistered&&b.registerPlugin(createjs.HTMLAudioPlugin),null==b.activePlugin)?!1:!0};b.getSrcFromId=function(a){return null==b.idHash||null==b.idHash[a]?a:b.idHash[a]};b.setVolume=function(a,g){if(null==Number(a))return!1;a=Math.max(0,Math.min(1,a));return b.tellAllInstances("setVolume",g,a)};b.getMasterVolume=
function(){return b.masterVolume};b.setMasterVolume=function(a){b.masterVolume=a;return b.tellAllInstances("setMasterVolume",null,a)};b.setMute=function(a){this.muted=a;return b.tellAllInstances("mute",null,a)};b.pause=function(a){return b.tellAllInstances("pause",a)};b.resume=function(a){return b.tellAllInstances("resume",a)};b.stop=function(a){return b.tellAllInstances("stop",a)};b.getInstanceById=function(a){return this.instanceHash[a]};b.playFinished=function(a){e.remove(a);a=this.instances.indexOf(a);
-1<a&&this.instances.splice(a,1)};b.tellAllInstances=function(a,b,c){if(null==this.activePlugin)return!1;for(var b=this.getSrcFromId(b),d=this.instances.length-1;0<=d;d--){var h=this.instances[d];if(!(null!=b&&h.src!=b))switch(a){case "pause":h.pause();break;case "resume":h.resume();break;case "setVolume":h.setVolume(c);break;case "setMasterVolume":h.setMasterVolume(c);break;case "mute":h.mute(c);break;case "stop":h.stop();break;case "setPan":h.setPan(c)}}return!0};b.proxy=function(a,b){return function(){return a.apply(b,
arguments)}};createjs.SoundJS=b;e.channels={};e.create=function(a,b){var c=e.get(a);null==c?e.channels[a]=new e(a,b):c.max+=b};e.add=function(a,b){var c=e.get(a.src);return null==c?!1:c.add(a,b)};e.remove=function(a){var b=e.get(a.src);if(null==b)return!1;b.remove(a);return!0};e.get=function(a){return e.channels[a]};e.prototype={src:null,max:null,length:0,init:function(a,b){this.src=a;this.max=b||1;this.instances=[]},get:function(a){return this.instances[a]},add:function(a,b){if(!this.getSlot(b,a))return!1;
this.instances.push(a);this.length++;return!0},remove:function(a){a=this.instances.indexOf(a);if(-1==a)return!1;this.instances.splice(a,1);this.length--;return!0},getSlot:function(a){for(var g,c,d=0,h=this.max||100;d<h;d++){g=this.get(d);if(null==g)return!0;if(a!=b.INTERRUPT_NONE)if(0==d)c=g;else if(g.playState==b.PLAY_FINISHED||g==b.PLAY_INTERRUPTED||g==b.PLAY_FAILED)c=g;else if(a==b.INTERRUPT_EARLY&&g.getPosition()<c.getPosition()||a==b.INTERRUPT_LATE&&g.getPosition()>c.getPosition())c=g}return null!=
c?(c.interrupt(),this.remove(c),!0):!1},toString:function(){return"[SoundJS SoundChannel]"}};b.defaultSoundInstance=new function(){this.isDefault=!0;this.pause=this.resume=this.play=this.beginPlaying=this.cleanUp=this.interrupt=this.stop=this.setMasterVolume=this.setVolume=this.mute=this.setPan=this.getPosition=this.setPosition=this.playFailed=function(){return!1};this.getVolume=this.getPan=this.getDuration=function(){return 0};this.playState=b.PLAY_FAILED;this.toString=function(){return"[SoundJS Default Sound Instance]"}};
f.init=function(){var a=navigator.userAgent;f.isFirefox=-1<a.indexOf("Firefox");f.isOpera=null!=window.opera;f.isIOS=-1<a.indexOf("iPod")||-1<a.indexOf("iPhone")||-1<a.indexOf("iPad")};f.init();createjs.SoundJS.BrowserDetect=f})();this.createjs=this.createjs||{};
(function(){function b(){this.init()}function e(a){this.init(a)}function f(a){this.init(a)}b.MAX_INSTANCES=30;b.capabilities=null;b.lastId=0;b.AUDIO_READY="canplaythrough";b.AUDIO_ENDED="ended";b.AUDIO_ERROR="error";b.AUDIO_STALLED="stalled";b.fillChannels=!1;b.isSupported=function(){if(createjs.SoundJS.BrowserDetect.isIOS)return!1;b.generateCapabilities();return null==b.tag?!1:!0};b.generateCapabilities=function(){if(null==b.capabilities){var a=b.tag=document.createElement("audio");if(null==a.canPlayType)return null;
b.capabilities={panning:!1,volume:!0,mp3:"no"!=a.canPlayType("audio/mp3")&&""!=a.canPlayType("audio/mp3"),ogg:"no"!=a.canPlayType("audio/ogg")&&""!=a.canPlayType("audio/ogg"),mpeg:"no"!=a.canPlayType("audio/mpeg")&&""!=a.canPlayType("audio/mpeg"),wav:"no"!=a.canPlayType("audio/wav")&&""!=a.canPlayType("audio/wav"),channels:b.MAX_INSTANCES}}};b.prototype={capabilities:null,FT:0.0010,channels:null,init:function(){this.capabilities=b.capabilities;this.channels={}},register:function(a,b){for(var c=f.get(a),
d,h=0,e=b||1;h<e;h++)d=this.createTag(a),c.add(d);return{tag:d}},createTag:function(a){var b=document.createElement("audio");b.preload=!1;b.src=a;return b},create:function(a){a=new e(a);a.owner=this;return a},toString:function(){return"[HTMLAudioPlugin]"}};createjs.HTMLAudioPlugin=b;e.prototype={src:null,uniqueId:-1,playState:null,owner:null,loaded:!1,lastInterrupt:createjs.SoundJS.INTERRUPT_NONE,offset:0,delay:0,volume:1,pan:0,remainingLoops:0,delayTimeout:-1,tag:null,muted:!1,paused:!1,onComplete:null,
onLoop:null,onReady:null,onPlayFailed:null,onPlayInterrupted:null,endedHandler:null,readyHandler:null,stalledHandler:null,init:function(a){this.uniqueId=createjs.HTMLAudioPlugin.lastId++;this.src=a;this.endedHandler=createjs.SoundJS.proxy(this.handleSoundComplete,this);this.readyHandler=createjs.SoundJS.proxy(this.handleSoundReady,this);this.stalledHandler=createjs.SoundJS.proxy(this.handleSoundStalled,this)},cleanUp:function(){var a=this.tag;if(null!=a){a.pause();try{a.currentTime=0}catch(b){}a.removeEventListener(createjs.HTMLAudioPlugin.AUDIO_ENDED,
this.endedHandler,!1);a.removeEventListener(createjs.HTMLAudioPlugin.AUDIO_READY,this.readyHandler,!1);f.setInstance(this.src,a);this.tag=null}null!=window.createjs&&createjs.SoundJS.playFinished(this)},interrupt:function(){if(null!=this.tag){this.playState=createjs.SoundJS.PLAY_INTERRUPTED;if(this.onPlayInterrupted)this.onPlayInterrupted(this);this.cleanUp();this.paused=!1}},play:function(a,b,c,d,h,e){this.cleanUp();createjs.SoundJS.playInstance(this,a,b,c,d,h,e)},beginPlaying:function(a,b,c){if(null!=
window.createjs){var d=this.tag=f.getInstance(this.src);if(null==d)return this.playFailed(),-1;d.addEventListener(createjs.HTMLAudioPlugin.AUDIO_ENDED,this.endedHandler,!1);this.offset=a;this.volume=c;this.updateVolume();this.remainingLoops=b;4!==d.readyState?(d.addEventListener(createjs.HTMLAudioPlugin.AUDIO_READY,this.readyHandler,!1),d.addEventListener(createjs.HTMLAudioPlugin.AUDIO_STALLED,this.stalledHandler,!1),d.load()):this.handleSoundReady(null);return 1}},handleSoundStalled:function(){if(null!=
this.onPlayFailed)this.onPlayFailed(this);this.cleanUp()},handleSoundReady:function(){null!=window.createjs&&(this.playState=createjs.SoundJS.PLAY_SUCCEEDED,this.paused=!1,this.tag.removeEventListener(createjs.HTMLAudioPlugin.AUDIO_READY,this.readyHandler,!1),this.offset>=this.getDuration()?this.playFailed():(0<this.offset&&(this.tag.currentTime=0.0010*this.offset),-1==this.remainingLoops&&(this.tag.loop=!0),this.tag.play()))},pause:function(){this.paused=!0;return null!=this.tag?(this.tag.pause(),
!1):!0},resume:function(){this.paused=!1;return null!=this.tag?(this.tag.play(),!1):!0},stop:function(){this.pause();this.playState=createjs.SoundJS.PLAY_FINISHED;this.cleanUp();return!0},setMasterVolume:function(){this.updateVolume();return!0},setVolume:function(a){this.volume=a;this.updateVolume();return!0},updateVolume:function(){return null!=this.tag?(this.tag.volume=this.muted?0:this.volume*createjs.SoundJS.masterVolume,!0):!1},getVolume:function(){return this.volume},mute:function(a){this.muted=
a;this.updateVolume();return!0},setPan:function(){return!1},getPan:function(){return 0},getPosition:function(){return null==this.tag?0:1E3*this.tag.currentTime},setPosition:function(a){if(null==this.tag)return!1;try{this.tag.currentTime=0.0010*a}catch(b){return!1}return!0},getDuration:function(){return null==this.tag?0:1E3*this.tag.duration},handleSoundComplete:function(){if(0!=this.remainingLoops){if(this.remainingLoops--,this.tag.play(),null!=this.onLoop)this.onLoop(this)}else if(null!=window.createjs){this.playState=
createjs.SoundJS.PLAY_FINISHED;if(null!=this.onComplete)this.onComplete(this);this.cleanUp()}},playFailed:function(){if(null!=window.createjs){this.playState=createjs.SoundJS.PLAY_FAILED;if(null!=this.onPlayFailed)this.onPlayFailed(this);this.cleanUp()}},toString:function(){return"[HTMLAudioPlugin SoundInstance]"}};f.channels={};f.get=function(a){var b=f.channels[a];null==b&&(b=f.channels[a]=new f(a));return b};f.getInstance=function(a){a=f.channels[a];return null==a?null:a.get()};f.setInstance=function(a,
b){var c=f.channels[a];return null==c?null:c.set(b)};f.prototype={src:null,length:0,available:0,tags:null,init:function(a){this.src=a;this.tags=[]},add:function(a){this.tags.push(a);this.length++;this.available=this.tags.length},get:function(){if(0==this.tags.length)return null;this.available=this.tags.length;var a=this.tags.pop();document.body.appendChild(a);return a},set:function(a){-1==this.tags.indexOf(a)&&this.tags.push(a);document.body.removeChild(a);this.available=this.tags.length},toString:function(){return"[HTMLAudioPlugin TagChannel]"}}})();this.createjs=this.createjs||{};
(function(){function b(){this.init()}function e(a,b){this.init(a,b)}function f(a,b){this.init(a,b)}b.capabilities=null;b.BASE_PATH="src/soundjs/";b.lastId=0;b.isSupported=function(){if(createjs.SoundJS.BrowserDetect.isIOS)return!1;b.generateCapabilities();return null==swfobject?!1:swfobject.hasFlashPlayerVersion("9.0.0")};b.generateCapabilities=function(){null==b.capabilities&&(b.capabilities={panning:!0,volume:!0,mp3:!0,ogg:!1,mpeg:!0,wav:!0,channels:255})};b.prototype={CONTAINER_ID:"flashAudioContainer",
capabilities:null,container:null,flash:null,flashReady:!1,flashInstances:null,flashPreloadInstances:null,queuedInstances:null,showOutput:!1,init:function(){this.capabilities=b.capabilities;this.flashInstances={};this.flashPreloadInstances={};this.queuedInstances=[];var a=this.container=document.createElement("div");a.id=this.CONTAINER_ID;a.appendChild(document.createTextNode("Default Content Here"));document.body.appendChild(a);swfobject.embedSWF(b.BASE_PATH+"FlashAudioPlugin.swf",this.CONTAINER_ID,
"1","1","9.0.0",null,null,null,null,createjs.SoundJS.proxy(this.handleSWFReady,this))},handleSWFReady:function(a){this.flash=a.ref;this.loadTimeout=setTimeout(function(){createjs.SoundJS.proxy(this.handleTimeout,this)},2E3)},handleFlashReady:function(){this.flashReady=!0;for(var a=0,b=this.queuedInstances.length;a<b;a++)this.flash.register(this.queuedInstances[a]);this.queuedInstances=null;for(var c in this.flashPreloadInstances)this.flashPreloadInstances[c].initialize(this.flash);for(c in this.flashInstances)this.flashInstances[c].initialize(this.flash)},
handleTimeout:function(){},register:function(a){this.flashReady?this.flash.register(a):this.queuedInstances.push(a);a=new f(a,this.flash);a.owner=this;return{tag:a}},create:function(a){try{var b=new e(a,this.flash);b.owner=this;return b}catch(c){}return null},registerPreloadInstance:function(a,b){this.flashPreloadInstances[a]=b},unregisterPreloadInstance:function(a){delete this.flashPreloadInstances[a]},registerSoundInstance:function(a,b){this.flashInstances[a]=b},unregisterSoundInstance:function(a){delete this.flashInstances[a]},
flashLog:function(a){this.showOutput&&console.log(a)},handleSoundEvent:function(a,b){var c=this.flashInstances[a];if(null!=c){for(var d=[],h=2,e=arguments.length;h<e;h++)d.push(arguments[h]);try{if(0==d.length)c[b]();else c[b].apply(c,d)}catch(f){}}},handlePreloadEvent:function(a,b){var c=this.flashPreloadInstances[a];if(null!=c){for(var d=[],e=2,f=arguments.length;e<f;e++)d.push(arguments[e]);try{if(0==d.length)c[b]();else c[b].apply(c,d)}catch(k){}}},handleEvent:function(a){switch(a){case "ready":clearTimeout(this.loadTimeout),
this.handleFlashReady()}},handleErrorEvent:function(){},toString:function(){return"[FlashPlugin]"}};createjs.FlashPlugin=b;e.prototype={src:null,uniqueId:-1,owner:null,capabilities:null,flash:null,flashId:null,loop:0,volume:1,pan:0,muted:!1,paused:!1,onComplete:null,onLoop:null,onReady:null,onPlayFailed:null,onPlayInterrupted:null,init:function(a,g){this.uniqueId=b.lastId++;this.src=a;this.flash=g},initialize:function(a){this.flash=a},interrupt:function(){this.playState=createjs.SoundJS.PLAY_INTERRUPTED;
if(null!=this.onPlayInterrupted)this.onPlayInterrupted(this);this.flash.interrupt(this.flashId);this.cleanUp()},cleanUp:function(){this.owner.unregisterSoundInstance(this.flashId);createjs.SoundJS.playFinished(this)},play:function(a,b,c,d,e,f){createjs.SoundJS.playInstance(this,a,b,c,d,e,f)},beginPlaying:function(a,b,c,d){this.loop=b;this.paused=!1;if(!this.owner.flashReady)return!1;this.flashId=this.flash.playSound(this.src,a,b,c,d);if(null==this.flashId){if(null!=this.onPlayFailed)this.onPlayFailed(this);
this.cleanUp();return!1}this.muted&&this.mute(!0);this.playState=createjs.SoundJS.PLAY_SUCCEEDED;this.owner.registerSoundInstance(this.flashId,this);return!0},playFailed:function(){this.playState=createjs.SoundJS.PLAY_FAILED;if(null!=this.onPlayFailed)this.onPlayFailed(this);this.cleanUp()},pause:function(){this.paused=!0;return this.flash.pauseSound(this.flashId)},resume:function(){this.paused=!1;return this.flash.resumeSound(this.flashId)},stop:function(){this.playState=createjs.SoundJS.PLAY_FINISHED;
this.paused=!1;var a=this.flash.stopSound(this.flashId);this.cleanUp();return a},setVolume:function(a){this.volume=a;return this.flash.setVolume(this.flashId,a)},getVolume:function(){return this.volume},mute:function(a){return(this.muted=a)?this.flash.muteSound(this.flashId):this.flash.unmuteSound(this.flashId)},getPan:function(){return this.pan},setPan:function(a){this.pan=a;return this.flash.setPan(this.flashId,a)},getPosition:function(){return this.flash.getPosition(this.flashId)},setPosition:function(a){return this.flash&&
this.flash.setPosition(this.flashId,a)},getDuration:function(){return this.flash?0:this.flash.getDuration(this.flashId)},handleSoundFinished:function(){this.playState=createjs.SoundJS.PLAY_FINISHED;if(null!=this.onComplete)this.onComplete(this);this.cleanUp()},handleLoop:function(){if(null!=this.onLoop)this.onLoop(this)},toString:function(){return"[FlashPlugin SoundInstance]"}};f.prototype={flash:null,src:null,flashId:null,progress:-1,readyState:0,loading:!1,owner:null,onload:null,onprogress:null,
onError:null,init:function(a,b){this.src=a;this.flash=b},initialize:function(a){this.flash=a;this.loading&&this.load(this.src)},load:function(a){null!=a&&(this.src=a);if(null==this.flash||!this.owner.flashReady)return loading=!0,!1;this.flashId=this.flash.preload(this.src);this.owner.registerPreloadInstance(this.flashId,this);return!0},handleProgress:function(a,b){this.progress=a/b;if(null!=this.onprogress)this.onprogress({loaded:a,total:b,progress:this.progress})},handleComplete:function(){this.progress=
1;this.readyState=4;if(null!=this.onload)this.onload()},handleError:function(a){if(null!=this.onerror)this.onerror(a)},toString:function(){return"[FlashPlugin SoundLoader]"}}})();
